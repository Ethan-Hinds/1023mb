<html>
	<head>
		<meta charset="UTF-8" />
		<script src="https://cdn.jsdelivr.net/npm/p5@0.7.2/lib/p5.min.js"></script>
	</head>

    <body>
        <label> Number of segments</label>
		<input type = "text" id = "numSegments" value = "5" />
		<label> Segment Length </label>
		<input type = "text" id = "segmentLength" value = "80" />
		<br>
		<br>
    </body>

	<script>

        let segments = [];
        let segmentLength =  80;
        let numSegments = 5;

        let tolerance = 2;

		function setup() {
			createCanvas(700, 700);
			angleMode(DEGREES);
            strokeWeight(5);


            let segmentLengthEl = document.querySelector("#segmentLength");
			segmentLengthEl.addEventListener("change", (event) => {
				let l = parseFloat(segmentLengthEl.value);
				for (let segment of segments) {
					segment.length = l;
				}
			});

			let numSegmentsEl = document.querySelector("#numSegments");
			numSegmentsEl.addEventListener("change", (event) => {
				let n = parseFloat(numSegmentsEl.value);
				if (n > 100) {
					n = 100;
					numSegmentsEl.value = 100;
				}
                numSegments = n;
                initSegments();
            });


            initSegments();

        }

        function initSegments() {
            segments = [];
            segments.push(new Segment(undefined, color(random(50, 255), random(50, 255), random(50, 255))));
            for (let i = 0; i < numSegments - 1; i += 1) {
                let col = color(random(50, 255), random(50, 255), random(50, 255));
                segments.push(new Segment(segments[segments.length-1], col));
            }

            for (let i = segments.length - 1; i >= 1; i -= 1) {
                segments[i].child = segments[i-1];
            }
        }

        function draw() {
            background(0);
            solve();
            for (let segment of segments) {
                segment.show();
            }
        }


        function solve() {
            let maxIterations = 100;

            for (let i = 0; i < maxIterations; i += 1) {
                if (i%2 == 0) {
                    let target = createVector(mouseX, mouseY);
                    for (let i = segments.length - 1; i >= 0; i -= 1) {
                        let segment = segments[i];
                        segment.b = target;
                        let dir = segment.a.sub(segment.b).normalize();
                        segment.a = segment.b.copy().add(dir.mult(segment.length));
                        target = segment.a.copy();
                    }
                } else {
                    let target = createVector(width/2, height*0.9);
                    for (let i = 0; i < segments.length; i += 1) {
                        let segment = segments[i];
                        segment.a = target;
                        let dir = segment.b.sub(segment.a).normalize();
                        segment.b = segment.a.copy().add(dir.mult(segment.length));
                        target = segment.b.copy();
                    }
                }
            }
        }


        class Segment {
            constructor(parent, col) {
                if (parent) {
                    this.parent = parent;
                    this.a = parent.a.copy().sub(0, segmentLength);
                    this.b = parent.b.copy().sub(0, segmentLength);
                } else {
                    this.parent = undefined;
                    this.a = createVector(width/2, height*0.9);
                    this.b = createVector(width/2, height*0.9-segmentLength);
                }
                this.col = col;
                this.length = segmentLength;
                this.child = undefined;
            }

            show() {
                stroke(this.col);
                line(this.a.x, this.a.y, this.b.x, this.b.y);
            }
        }

	</script>
</html>
