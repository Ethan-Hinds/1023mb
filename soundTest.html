<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.js"></script>
  <script language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/addons/p5.sound.min.js"></script>
</head>

<body>
    <label> Increment </label>
    <input type = "text" id = "increment">
    <label> Limit </label> 
    <input type = "text" id = "limit">
    <button onclick = "go()"> Go </button>
    <button onclick = "stopTone()"> Stop Tone </button>
    <label> Pitch </label>
    <input type = "text" id = "multiplier" value = 60>
    <br>
    <textarea id = "result" style = "visibility: hidden;" readonly></textarea>
    <br>
</body>

<script>

    let ones = [];
    let o;
    let multiplier = 60;

    function setup() {
        createCanvas(700, 700);
        fill("red");
        stroke("red");
    }

    function draw() {
        background(0);
        for (let i = 0; i < ones.length-1; i += 1) {
            let multVal = parseFloat(document.getElementById("multiplier").value);
            if (!isNaN(multVal)) {
                multiplier = multVal;
            }
            let freq = (ones[i+1] - ones[i]) * multiplier;
            o.frequency.value = freq;
        }
        // for (let i = 0; i < nums.length-1; i += 1) {
        //     let x = i;
        //     let y = nums[i] == 0 ? height*0.9 : height*0.5;
        //     ellipse(x, y, 1, 1);
        //     if (nums[i] != nums[i+1]) {
        //         line(x, height*0.9, x, height*0.5);
        //     }
        // }
    }

    function stopTone() {
        o.stop();
    }

    function go() {
        let n = 0;
        let increment = parseFloat(document.getElementById("increment").value);
        let limit = parseFloat(document.getElementById("limit").value);
        let status = 0;
        ones = [];

        for (let i = 0; i < 700; i += 1) {
            n += increment;
            if (n > limit) {
                if (status == 0) {
                    status = 1;
                    ones.push(i);
                } else {
                    status = 0;
                }
                n -= limit;
            }
        }

        var context = new AudioContext();
        o = context.createOscillator();
        o.connect(context.destination);
        o.start();

    }

</script>

</html>